# Claude Statusline CLI Wizard — Design

**Date:** 2026-02-19
**Status:** Approved

## Problem

Setting up a Claude Code statusline requires manually editing a bash script and patching `~/.claude/settings.json`. The existing `install.sh` copies a static script with no customization — users must read the code to change what data is shown or how it's formatted.

## Goal

A single CLI command (`npx claude-statusline`) that interactively guides the user through picking what data to show and how to format it, previews the result, then writes the final script and patches settings automatically.

---

## Approach

**Node.js + `@clack/prompts`** — a prompts wizard that outputs a self-contained bash script.

- No build step, no TypeScript compilation
- `@clack/prompts` provides multiselect, confirm, spinner, and styled output out of the box
- `npx claude-statusline` works immediately after publish
- Output is a standalone bash script (same structure as the existing `statusline.sh`) — no runtime config file

Rejected alternatives:
- **TypeScript + Ink**: overkill for a config wizard, adds build step, slower `npx` startup
- **Pure shell wizard**: no checkboxes, worse UX, harder to maintain

---

## File Structure

```
claude-statusline/
  statusline.sh          # existing — reference/template (not run directly by users)
  install.sh             # simplified — calls setup.js after copying it
  uninstall.sh           # existing, unchanged
  setup.js               # new — interactive CLI wizard
  package.json           # new — npm package, bin entry point
  docs/
    plans/
      2026-02-19-statusline-cli-design.md
```

---

## Wizard Flow

### Step 1: Account detection (silent)
Check for OAuth credentials in macOS Keychain (`security find-generic-password -s "Claude Code-credentials"`) and fall back to `~/.claude/.credentials.json`. If credentials are found, rate-limit fields are available. If not, those fields are hidden — no prompt, no error.

### Step 2: Pick data fields (multiselect)
Always available:
- Model name
- Token counts (used / total)
- Used % with raw token count
- Remaining % with raw token count
- Lines changed (+added / -removed)
- Context window progress bar

Only shown if OAuth credentials detected:
- 5-hour rate limit bar
- Weekly rate limit bar
- Rate limit reset times

### Step 3: Pick layout
- **Single line** — all selected fields on one line
- **Multi-line** — fields distributed across 2–3 lines (model+tokens on line 1, bars on line 2, reset times on line 3)

### Step 4: Pick color style
- **Traffic-light** (default) — green < 50%, yellow 50–79%, red ≥ 80%
- **Monochrome** — no colors, plain text only
- **Custom thresholds** — prompts for yellow and red cutoff percentages

### Step 5: Preview
Render a sample statusline using hardcoded realistic fake data (e.g. 35% context used, model "Claude Sonnet 4.6"). Print it to the terminal with actual ANSI codes so the user sees exactly what they'll get.

### Step 6: Confirm and write
- Confirm prompt: "Write this to ~/.claude/statusline-command.sh?"
- Write the generated bash script
- Patch `~/.claude/settings.json`: read existing JSON (or `{}`), set only the `statusLine` key, write back — all other keys preserved
- If `settings.json` is malformed JSON: warn and exit without writing

---

## Generated Script Contract

The wizard generates a self-contained bash script that:
- Reads JSON from stdin (Claude Code pipes it on each render tick)
- Extracts only the fields the user selected
- Outputs 1–3 lines of ANSI-colored text matching the chosen layout
- Has no external dependencies beyond `jq` and `bash`
- Includes a comment header identifying it as generated by `claude-statusline`

The script is **not** a template with placeholders — it's a fully rendered bash script with the user's choices baked in. Re-running `npx claude-statusline` overwrites it.

---

## settings.json Patch

```js
const raw = fs.existsSync(settingsPath) ? fs.readFileSync(settingsPath, 'utf8') : '{}'
let settings
try {
  settings = JSON.parse(raw)
} catch {
  clack.log.error('~/.claude/settings.json is not valid JSON — aborting to avoid corruption')
  process.exit(1)
}
settings.statusLine = { type: 'command', command: '/bin/bash ~/.claude/statusline-command.sh' }
fs.writeFileSync(settingsPath, JSON.stringify(settings, null, 2) + '\n')
```

Only `statusLine` is touched. All other keys (`permissions`, `hooks`, `model`, `enabledPlugins`, etc.) pass through unchanged.

---

## npm Package

```json
{
  "name": "claude-statusline",
  "version": "1.0.0",
  "bin": { "claude-statusline": "./setup.js" },
  "dependencies": { "@clack/prompts": "^0.9.0" }
}
```

`npx claude-statusline` runs `setup.js` directly. No compile step.

---

## Out of Scope

- GUI or web-based configurator
- Multiple saved profiles
- Auto-update of the generated script when Claude Code updates
- Windows support (bash script output is macOS/Linux only)
